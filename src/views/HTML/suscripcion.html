<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Suscripci√≥n</title>
    <link rel="stylesheet" href="../static/CSS/suscripcion.css">
</head>
<body>

    <header class="container">
        <nav>
            <a href="/" class="nav-logo">
                <img src="../static/images/milen-2.webp" alt="Logo Milenzo">
            </a>
            <div class="nav-buttons">
                <a href="/myPets" class="nav-button">Mis Mascotas</a>
                <a href="/serv" class="nav-button">Servicios</a>
                <a href="/about" class="nav-button">Nosotros</a>
            </div>
            {% if is_logged_in %}
                <a href="/logout" class="logout-button" >Cerrar Sesion</a>
            {% else %}
                <a href="/login" class="login-button">Login</a>
            {% endif %}
        </nav>
    </header>
    <main>
        <div class="subscription-container">
            <div class="subscription-header">
                <h2>Complete su Suscripci√≥n</h2>
                <p>Disfrute de acceso ilimitado a todos nuestros servicios</p>
            </div>

            <div class="subscription-plan">
                <div class="plan-selected">
                    <h3>Plan Seleccionado</h3>
                    <div class="plan-details">
                        <span id="selected-plan-name" class="plan-name"></span>
                        <span id="selected-plan-price" class="price-plan"></span>
                    </div>
                </div>
            </div>
            <div id="mensaje-confirmacion"></div>
            <form id="suscripcion-form" action="/procesar_suscripcion" method="POST">
                <div class="form-section">
                <h4>Informaci√≥n del Usuario</h4>
                <div class="form-group">
                    <label for="name">Nombre completo</label>
                    <input type="text" id="name" placeholder="Ingrese su nombre completo" required>
                </div>
                <div class="form-group">
                    <label for="email">Correo electr√≥nico</label>
                    <input type="email" id="email" placeholder="ejemplo@correo.com" required>
                </div>
                </div>

                <div class="form-section">
                <h4>Informaci√≥n de Pago</h4>
                <div id="card-element" class="stripe-card-element">
                    <!-- Stripe Card Element will be inserted here -->
                </div>
                <div id="card-errors" role="alert" class="stripe-errors"></div>
                </div>

                <div class="form-actions">
                <button type="submit" class="subscribe-button">
                    <span class="button-text">Suscribirse ahora</span>
                    <span id="final-price" class="price-plan"></span>
                </button>
                <p class="secure-payment">
                    <i class="lock-icon"></i> Pago seguro procesado por Stripe
                </p>
                </div>
            </form>

            <div class="subscription-footer">
                <div class="footer-links">
                <a href="#">Pol√≠tica de Privacidad</a>
                <a href="#">T√©rminos y Condiciones</a>
                <a href="#">Contacto</a>
                </div>
                <p class="copyright">¬© 2025 N√∫mero. Todos los derechos reservados.</p>
            </div>
        </div>
    </main>

    <footer class="footer">
        <p>&copy; 2025 Milenzo. Todos los derechos reservados.</p>
        <div class="footer-links">
            <a href="#">Pol√≠tica de Privacidad</a>
            <a href="#">T√©rminos y Condiciones</a>
            <a href="#">Contacto</a>
        </div>
    </footer>
    <div id="modal-privacidad" class="modal">
        <div class="modal-contenido">
            <span class="cerrar" onclick="cerrarModal('modal-privacidad')">&times;</span>
            <h2>Pol√≠tica de Privacidad</h2>
            <p>üõ°Ô∏è √öltima actualizaci√≥n: abril de 2025
    
            <p> En MilenzoPet, tu privacidad es muy importante para nosotros. Recopilamos y utilizamos informaci√≥n personal √∫nicamente con el objetivo de mejorar tu experiencia en nuestra plataforma, facilitar el acceso a servicios veterinarios y optimizar la gesti√≥n de citas y cuidados para tus mascotas.
                
                <p> ¬øQu√© informaci√≥n recopilamos?
                    <p>*Datos personales proporcionados al crear una cuenta (nombre, correo electr√≥nico, tel√©fono).
                    <p>*Informaci√≥n sobre tus mascotas (nombre, especie, edad).
                    <p>*Historial de citas y servicios utilizados.
                    <p>*Datos de navegaci√≥n y uso de la plataforma (cookies y an√°lisis estad√≠stico).
                
                    <p>¬øC√≥mo usamos tus datos?
                    <p>*Para agendar y gestionar citas veterinarias y servicios relacionados.
                    <p>*Para personalizar tu experiencia en la plataforma.
                    <p>*Para contactar contigo en relaci√≥n con tus solicitudes o servicios.
                    <p>*Para fines estad√≠sticos y de mejora continua del servicio.
                
                <p>¬øCon qui√©n compartimos tus datos?
                    <p>No vendemos ni alquilamos tu informaci√≥n personal. Solo compartimos datos con profesionales o servicios asociados cuando sea estrictamente necesario para brindarte una mejor atenci√≥n.
            Tus derechos
                        <p></p>Pod√©s acceder, modificar o eliminar tus datos en cualquier momento. Si ten√©s alguna duda sobre nuestra pol√≠tica de privacidad, escribinos a soporte@milenzopet.com.</p>
        </div>
        </div>
        <div id="modal-terminos" class="modal">
        <div class="modal-contenido">
            <span class="cerrar" onclick="cerrarModal('modal-terminos')">&times;</span>
            <h2>T√©rminos y Condiciones</h2>
            <p>üìúBienvenido a MilenzoPet
            <p> Estos t√©rminos regulan el uso de nuestra plataforma. Al acceder y utilizar nuestros servicios, acept√°s las siguientes condiciones:
            
            <p> Uso de la plataforma:
    
            <p> *El usuario se compromete a brindar informaci√≥n veraz y actualizada.
            
            <p> *Los servicios ofrecidos est√°n destinados exclusivamente al cuidado y bienestar de mascotas.
            
            <p></p>*MilenzoPet se reserva el derecho de suspender cuentas en caso de uso indebido o fraudulento.
            
            <p> Servicios:
            
                <p></p>*MilenzoPet facilita la conexi√≥n entre due√±os de mascotas y profesionales del sector veterinario, est√©tico y de transporte.
            
                <p> *Las citas agendadas a trav√©s de la plataforma son responsabilidad de las partes involucradas (usuario y profesional).
            
            <p>Propiedad intelectual: 
            
                <p>*Todo el contenido, dise√±o, logos, textos e im√°genes son propiedad de MilenzoPet y no pueden ser utilizados sin autorizaci√≥n previa.
            
            <p> Modificaciones:
            
                <p>* MilenzoPet puede actualizar estos t√©rminos sin previo aviso. Te recomendamos revisarlos peri√≥dicamente.</p>
        </div>
        </div>
        
        <div id="modal-contacto" class="modal">
        <div class="modal-contenido">
            <span class="cerrar" onclick="cerrarModal('modal-contacto')">&times;</span>
            <h2>Contacto</h2>
            <p>üì¨  ¬øTen√©s alguna duda, sugerencia o necesit√°s ayuda? ¬°Estamos para ayudarte!
    
            <p> *Email: contacto@milenzopet.com
            <p> *Tel√©fono: +52 305 4846421
            <p> *Horario de atenci√≥n: Lunes a viernes de 9:00 a 18:00 hs.
            <p> *Redes sociales:
            <p> *Instagram / Facebook / Twitter: @MilenzoPet</p>
        </div>
        </div>
    
    <script src="https://js.stripe.com/v3/"></script>
    <script>
        document.addEventListener("DOMContentLoaded", function() {
            // Configuraci√≥n Stripe
            const stripe = Stripe("pk_test_51ROjP4Pk7Erlpm35VR4UsniQR5uJD1OXrKPOdq50VwAaPG9do8YX7A1BzMIWgIqzjqqSKIqJtXTSLRVmMPDT8zeB00BBmAQOKW"); 
            const elements = stripe.elements();

            const card = elements.create("card", {
                style: {
                    base: {
                        fontSize: '16px',
                        color: '#32325d',
                        '::placeholder': { color: '#aab7c4' }
                    },
                    invalid: { color: '#fa755a', iconColor: '#fa755a' }
                },
                hidePostalCode: true
            });
            card.mount("#card-element");

            // Manejo del formulario
            const form = document.getElementById("suscripcion-form");
            form.addEventListener("submit", async function(event) {
                event.preventDefault();
                const submitButton = form.querySelector('button[type="submit"]');
                submitButton.disabled = true;
                submitButton.innerHTML = '<span class="button-text">Procesando...</span>';

                try {
                    // Crear token de pago
                    const { token, error } = await stripe.createToken(card);
                    if (error) throw error;

                    // Obtener datos del formulario
                    const formData = {
                        plan: form.querySelector('input[name="plan"]').value,
                        name: form.querySelector('#name').value,
                        email: form.querySelector('#email').value,
                        stripe_token: token.id
                    };

                    // Enviar al backend
                    const response = await fetch("/api/v1/process-subscription", {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify(formData)
                    });

                    const data = await response.json();
                    if (!response.ok) throw new Error(data.detail || "Error al procesar el pago");

                    // Mostrar mensaje de √©xito en la misma p√°gina
                    document.getElementById("mensaje-confirmacion").innerHTML = `
                        <div class="mensaje-exito">
                            <h2>¬°Pago realizado con √©xito!</h2>
                            <p>Tu pago fue procesado correctamente. Revisa tu correo para ver la confirmaci√≥n.</p>
                            <p><strong>ID de transacci√≥n:</strong> ${data.payment_id}</p>
                        </div>
                    `;
                    form.reset();
                    card.clear();
                    submitButton.disabled = false;
                    submitButton.innerHTML = '<span class="button-text">Suscribirse ahora</span>';

                } catch (error) {
                    document.getElementById("card-errors").textContent = error.message;
                    submitButton.disabled = false;
                    submitButton.innerHTML = '<span class="button-text">Suscribirse ahora</span>';
                }
            });
        });

    </script>
    <script src="../static/JS/suscripcion.js"></script>
</body>
</html>